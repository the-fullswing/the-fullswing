#!/bin/sh

# pre-push hook: push 전에 인덱스 파일 생성 및 커밋

echo "🔍 인덱스 파일 생성 중..."

# 인덱스 파일 생성
pnpm run generate-index

# 변경사항 확인
if git diff --quiet posts/*/index.md posts/index.md; then
    echo "✅ 인덱스 파일에 변경사항이 없습니다."
else
    echo "📝 인덱스 파일에 변경사항이 발견되었습니다. 자동 커밋 중..."
    
    # 변경된 인덱스 파일들을 스테이징
    git add posts/*/index.md posts/index.md
    
    # 커밋
    git commit -m "Auto-generate index files before push"
    
    echo "✅ 인덱스 파일이 자동으로 커밋되었습니다."
    echo "💡 push를 다시 실행해주세요."
    
    # push 중단
    exit 1
fi 
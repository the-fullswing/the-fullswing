#!/bin/sh

# pre-push hook: push ì „ì— ì¸ë±ìŠ¤ íŒŒì¼ ìƒì„± ë° ì»¤ë°‹

echo "ğŸ” ì¸ë±ìŠ¤ íŒŒì¼ ìƒì„± ì¤‘..."

# ì¸ë±ìŠ¤ íŒŒì¼ ìƒì„±
pnpm run generate-index

# ë³€ê²½ì‚¬í•­ í™•ì¸
if git diff --quiet posts/*/index.md posts/index.md; then
    echo "âœ… ì¸ë±ìŠ¤ íŒŒì¼ì— ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
else
    echo "ğŸ“ ì¸ë±ìŠ¤ íŒŒì¼ì— ë³€ê²½ì‚¬í•­ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ìë™ ì»¤ë°‹ ì¤‘..."
    
    # ë³€ê²½ëœ ì¸ë±ìŠ¤ íŒŒì¼ë“¤ì„ ìŠ¤í…Œì´ì§•
    git add posts/*/index.md posts/index.md
    
    # ì»¤ë°‹
    git commit -m "Auto-generate index files before push"
    
    echo "âœ… ì¸ë±ìŠ¤ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤."
    echo "ğŸ’¡ pushë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”."
    
    # push ì¤‘ë‹¨
    exit 1
fi 
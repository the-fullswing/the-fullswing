## 무신사-무진장 세일 (https://medium.com/musinsa-tech/%EB%AC%B4%EC%A7%84%EC%9E%A5-%ED%9E%98%EB%93%A4%EC%97%88%EC%A7%80%EB%A7%8C-%EB%AC%B4%EC%A7%84%EC%9E%A5-%EC%84%B1%EC%9E%A5%ED%95%9C-%EA%B0%9C%EB%B0%9C-%EC%9D%B4%EC%95%BC%EA%B8%B0-e445888579a9)

### **수백만 사용자의 동시 접속을 막아내는 이벤트 전시 시스템**
### 폭주하는 주문을 완벽하게 처리하는 주문/재고/쿠폰 시스템
### 안정적인 운영 시스템

### 수백만 사용자의 동시 접속을 막아내는 이벤트 전시 페이지 시스템
1. 초당 6만 6천 개의 요청을 처리하기 위해 CQRS 도입
* 분당 400만 요청의 대부분은 읽기 작업
* 모놀리식 아키텍처 시기 조회와 주문 생성이 동일한 데이터베이스를 바라보고, 읽기 요청의 폭주로 DB Connection Pool 고갈 > 주문 처리(쓰기)가 불가능해져 전체 서비스 마비
* CQRS 패턴 도입
  * Command : 주문 생성, 재고 차감 등 데이터 일관성이 중요한 쓰기 작업은 트랜잭션 DB에서 처리
  * Query : 빠르고 대규모 처리가 필요한 읽기 작업은 조회 전용 Redis 사용, 모든 상품 데이터를 사전에 가공해서 Materialized View 형태로 저장
  * 최종적 일관성(Eventual Consistency) 과제 해결을 위해 CDC 파이프라인 구축
  * 파이프라인에서 발생하는 몇 초간의 데이터 지연은 서비스 전체가 마비될 수 있는 위험보다 합리적인 비즈니스 트레이드오프로 판단

2. 다음 문제는, Redis 데이터 압축 최적화
* 복잡한 상품 정보를 JSON 형태로 직렬화 하면 데이터 크기가 수십 KB를 넘어, 막대한 메모리 비용을 초래
* 압축률보다는 압축 해재속도와 CPU 사용량이 중요한 성능 지표 > LZ4 알고리즘 선택하여 압축
* 1KB 미만 데이터는 원문 그대로 저장, 1KB 이상 데이터는 LZ4 압축 후 저장하는 조건부 압축
